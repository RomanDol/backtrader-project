{% extends "base.html" %} {% block title %}Strategy Backtest - Backtrader
Platform{% endblock %} {% block content %}
<div
  style="
    display: flex;
    height: calc(100vh - var(--nav-height));
    overflow: hidden;
  "
>
  <!-- Левая часть (2/3 ширины) - разделена на верх и низ -->
  <div
    style="
      flex: 2;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      padding: var(--spacing-sm);
    "
  >
    <!-- Верхняя часть - График свечей -->
    <div style="flex: 1">
      <div id="candlestick-chart" style="width: 100%; height: 100%"></div>
    </div>

    <!-- Нижняя часть - График доходности  -->
    <div style="flex: 1">
      <div id="equity-chart" style="width: 100%; height: 100%"></div>
    </div>
  </div>

  <!-- Правая часть (1/3 ширины) - Форма параметров -->
  <div
    style="
      flex: 1;
      background: var(--bg-gradient-primary);
      border-left: var(--border-width) solid var(--border-color);
      padding: var(--spacing-lg);
      overflow-y: auto;
    "
  >
    <h2 style="margin: 0 0 var(--spacing-md) 0; color: var(--color-primary)">
      ⚙️ Strategy Parameters
    </h2>

    <form id="backtest-form">
      <div class="form-group">
        <label for="symbol-select">Symbol:</label>
        <select id="symbol-select" name="symbol" required>
          <option value="">Select symbol...</option>
        </select>
      </div>

      <div class="form-group">
        <label for="timeframe-select">Timeframe:</label>
        <select id="timeframe-select" name="timeframe" required>
          <option value="">Select timeframe...</option>
        </select>
      </div>

      <div class="form-group">
        <label for="start-date">Start Date:</label>
        <input type="date" id="start-date" name="start_date" required />
      </div>

      <div class="form-group">
        <label for="end-date">End Date:</label>
        <input type="date" id="end-date" name="end_date" required />
      </div>

      <hr
        style="
          margin: var(--spacing-lg) 0;
          border: none;
          border-top: var(--border-width) solid var(--border-color);
        "
      />

      <h3
        style="margin: 0 0 var(--spacing-md) 0; color: var(--color-secondary)"
      >
        Strategy Settings
      </h3>

      <div class="form-group">
        <label for="initial-cash">Initial Cash ($):</label>
        <input
          type="number"
          id="initial-cash"
          name="initial_cash"
          value="10000"
          min="100"
          step="100"
          required
        />
      </div>

      <div class="form-group">
        <label for="commission">Commission (%):</label>
        <input
          type="number"
          id="commission"
          name="commission"
          value="0.1"
          min="0"
          max="5"
          step="0.01"
          required
        />
      </div>

      <div class="form-group">
        <label for="fast-period">Fast MA Period:</label>
        <input
          type="number"
          id="fast-period"
          name="fast_period"
          value="10"
          min="2"
          max="50"
          required
        />
      </div>

      <div class="form-group">
        <label for="slow-period">Slow MA Period:</label>
        <input
          type="number"
          id="slow-period"
          name="slow_period"
          value="30"
          min="5"
          max="200"
          required
        />
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" style="width: 100%">
          <span class="btn-icon">▶️</span>
          Run Backtest
        </button>
      </div>
    </form>

    <div
      id="backtest-message"
      class="message"
      style="display: none; margin-top: var(--spacing-md)"
    ></div>
  </div>
</div>
{% endblock %} {% block js %}
<script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
<script>
  // Ждём полной загрузки библиотеки
  window.addEventListener("load", function () {
    console.log("Window fully loaded")
    console.log("LightweightCharts:", typeof LightweightCharts)
  })
</script>
<script src="{{ url_for('static', filename='js/backtest.js') }}" defer></script>
{% endblock %}
